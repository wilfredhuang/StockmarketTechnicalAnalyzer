{% extends "layouts/layout.html" %}
{% block title %}Home - Stock Analysis{% endblock %}
{% block extra_css %}
<style>
    #chart-container {
        width: 100%;
        height: 600px;
    }
</style>
{% endblock %}
{% block content %}
<!-- Grid Layout with Buttons -->
<div class="container mt-4">
    <div class="row mb-3">
        <div class="col-md-6">
            <p>Fetch Data</p>
        </div>
        <div class="col-md-6">
            <button id="fetch-data" class="btn btn-success w-100">Fetch Data</button>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-6">
            <p>Process Data</p>
        </div>
        <div class="col-md-6">
            <button id="process-data" class="btn btn-success w-100">Process Data</button>
        </div>
    </div>
    <div class="row mb-3">
        <div class="col-md-6">
            <p>Generate Chart</p>
        </div>
        <div class="col-md-6">
            <input type="text" id="ticker-input" class="form-control mb-2" placeholder="Enter ticker symbol">
            <button id="generate-chart" class="btn btn-success w-100">Generate Chart</button>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div id="chart-container"></div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    function sendRequest(url, method, data) {
        return fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    }

    document.getElementById('fetch-data').addEventListener('click', function() {
        sendRequest('/fetch_data', 'POST', {
            tickers: 'AAPL,MSFT,GOOGL',  // You can modify this or make it dynamic
            start_date: '2020-01-01',    // You can modify this or make it dynamic
            end_date: '2023-12-31'       // You can modify this or make it dynamic
        })
        .then(data => {
            alert(data.message);
        });
    });

    document.getElementById('process-data').addEventListener('click', function() {
        sendRequest('/process_data', 'POST')
        .then(data => {
            alert(data.message);
        });
    });

    document.getElementById('generate-chart').addEventListener('click', function() {
        const ticker = document.getElementById('ticker-input').value;
        if (!ticker) {
            alert('Please enter a ticker symbol');
            return;
        }
        sendRequest('/get_chart', 'POST', { ticker: ticker })
        .then(data => {
            Plotly.newPlot('chart-container', data.data, data.layout);
        });
    });
});
</script>
{% endblock %}